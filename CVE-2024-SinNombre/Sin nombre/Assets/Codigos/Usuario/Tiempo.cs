using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using UnityEngine.Video;
using UnityEngine.SceneManagement;



public class Tiempo : MonoBehaviour
{
    public Virus virus;
    GameObject GOVirus;
    public float tiempo;

   // public float tiempoMax;
    public bool start;
    [SerializeField]
    private int min;
    [SerializeField]
    private int seg;
    [SerializeField]
    private TMPro.TextMeshProUGUI TiempoText;

    public float tiempoPantalla;
    int tiempoMin;
    int tiempoSeg;
    float TiempoMax;

    public float TiempoVirus;

    //____________Escoger tarea
    [SerializeField]
    private TMPro.TextMeshProUGUI Sig;
    [SerializeField]
    private GameObject Iniciar;
    [SerializeField]
    private GameObject Elecion;
    int c = 0;

    //Movimiento
    public GameObject ControlMov;
    public Usuario usuario;
    [SerializeField]
    private TMPro.TextMeshProUGUI indicaciones;

    public void Awake()
    {
        tiempo = (min * 60) + seg;
        tiempoPantalla = (tiempoMin * 60) + tiempoSeg;
        TiempoMax = tiempo;

    }

    public void Update()
    {
        //TiempoText.text = "Completado en:  " + min.ToString() + "minutos con " + seg.ToString() + " segundos.";
        GOVirus = GameObject.Find("CVE-2024-SinNombre");
        if (GOVirus != null)
        {
            if (virus.avance >= 10)
            {
                start = true;
            }

            if (start)
            {
                tiempo -= Time.deltaTime;
                tiempoPantalla += Time.deltaTime;

                TiempoVirus = tiempoPantalla * 100 / TiempoMax - 5f;
                virus.avance = TiempoVirus + 10f;

                if (tiempo <= 0)
                {
                    //Debug.Log("Tiempo terminado");
                    start = false;

                }
            }


            min = Mathf.FloorToInt(tiempo / 60f);
            seg = Mathf.FloorToInt(tiempo % 60f);

            tiempoMin = Mathf.FloorToInt(tiempoPantalla / 60f);
            tiempoSeg = Mathf.FloorToInt(tiempoPantalla % 60f);


            min = tiempoMin;
            seg = tiempoSeg;

        }
        else
        {
            Debug.Log("Ok");
        }
        TiempoText.text = "05:" + tiempoMin.ToString("00") + " p.m.\n" +
                          "09/05/2024";

        PlayerPrefs.SetInt("tiempoMin", tiempoMin);
        PlayerPrefs.SetInt("tiempoSeg", tiempoSeg);
        ControlMovimiento();
    }

   
     
    public void ControlMovimiento()
    {
        if (Input.GetKeyDown(KeyCode.LeftAlt)){
            usuario.enabled = false;
            indicaciones.text = "Presiona Ctrl si quieres reanudar el movimiento de la camara.";

        }else if (Input.GetKeyDown(KeyCode.LeftControl)){
            
            usuario.enabled = true;
            indicaciones.text = "Presiona Alt si quieres detener el movimiento de la camara";
        }
    }

    public void Tareas()
    {
        c++;
        switch (c)
        {
            case 1:
                Sig.text = "Eso es el resumen, para conocer mas puedes ir a los archivos y \n" +
                            "buscar los manuales de cada aplicacio. \n\n" +
                            "Ahorita tenemos falta de personal por lo tanto no puedo explicarte \n" +
                            "todo hoy a si que lo haremos de manera interactiva, empecemos por \n" +
                            "escoger una actividad.\n\n" +
                            "La primera es la actualizacion de un software del laboratorio 3 de la \n" +
                            "computadora 111, ya esta autorizado.\n\n" +
                            "Y la segunda, digamos que a Ruben, de Administracion de redes \n" +
                            "olvido su contraseña, asi que debemos cambiarla, asi que dime, ¿Que \n" +
                            "quieres hacer para empezar?";
                Elecion.SetActive(true);
                break;
            case 2:
                Iniciar.SetActive(false);
                break;
        }
    }

    
}
