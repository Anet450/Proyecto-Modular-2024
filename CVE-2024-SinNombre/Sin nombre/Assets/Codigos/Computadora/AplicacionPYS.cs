using System.Collections;
using System.Collections.Generic;
using TMPro;
using Unity.VisualScripting;
using UnityEngine;
using UnityEngine.UI;
using UnityEngine.Video;

public class AplicacionPYS : MonoBehaviour
{

    public TextMeshProUGUI textoResBusquedaCopia;
    public TextMeshProUGUI textoCopiaABuscar;

    //Variables para obtener las funciones de la aplicacion.
    [SerializeField]
    private GameObject FuncCopias;
    [SerializeField]
    private GameObject FuncActualizar;
    [SerializeField]
    private GameObject FuncPerfil;

    //Variables uso de la funcion Actualizar

    [SerializeField]
    private GameObject Fijar;
    [SerializeField]
    private GameObject Aplicar;
    [SerializeField]
    private GameObject Copiar;
    

    [SerializeField]
    private Image Barra; //controlador de tiempo de carga
    [SerializeField]
    private GameObject Preparando;
    [SerializeField]
    private TMPro.TextMeshProUGUI Text;
    private bool Cargar = false; //indicador de que la carga es falsa
    private float tiempoM = 10; //tiempo de actualizacion normal
    private float tiempoMR = 5; //tiempo de actualizacion completa
    private float tiempoAct;


    //Mensajes.
    [SerializeField]
    private GameObject MensajeAdv;
    [SerializeField]
    private GameObject CopiaCompleta;

    //Variables uso de la funcion Perfil.
    public CambioPantalla DenegacionS;
    private bool apagado = false;


    private void Update()
    {
        
        if (Cargar)
        {
            IncActualizacion();
        }
        if (Input.GetKeyDown(KeyCode.X))
        {
            Preparando.SetActive(false);
            tiempoAct = 0;
        }

    }
    public void DengarS()
    {
        DenegacionS.Denegado();
    }

    public void Copias()
    {
        FuncCopias.SetActive(!FuncCopias.activeInHierarchy);
        FuncActualizar.SetActive(false);
        FuncPerfil.SetActive(false);
        Preparando.SetActive(false);
    }
    public void Actualizar()
    {
        FuncActualizar.SetActive(!FuncActualizar.activeInHierarchy);
        FuncCopias.SetActive(false);
        FuncPerfil.SetActive(false);
        CopiaCompleta.SetActive(false);
        Preparando.SetActive(false);
    }

    public void Perfil()
    {
        FuncPerfil.SetActive(!FuncPerfil.activeInHierarchy);
        FuncCopias.SetActive(false);
        FuncActualizar.SetActive(false);
        Preparando.SetActive(false);

    }

    //_________________________Funciones de la opcion de Actualizar_________________________________


    public void OpcAplicar()
    {
        Aplicar.SetActive(!Aplicar.activeInHierarchy);
        Preparando.SetActive(false);
    }
    public void OpciActualizar()
    {
        MensajeAdv.SetActive(true);
        Aplicar.SetActive(false);
        CopiaCompleta.SetActive(apagado);
        Preparando.SetActive(false);
    }

    public void OpcContinuar()
    {
        MensajeAdv.SetActive(false);
        Aplicar.SetActive(false);
        CopiaCompleta.SetActive(apagado);
        ActActualizacion(); //preparando carga
        Debug.Log("Iniciar actualizacion");

    }

    public void OpciActualizacionRapida()
    {
        IncActualizacionRapida();
        Aplicar.SetActive(false);
        Debug.Log("Iniciar actualizacion rapida");
    }
    public void IncActualizacion()
    {
        tiempoAct -= Time.deltaTime; //resta el tiempo que falta de carga completa
        if(tiempoAct >= 0) //si el tiempo actual es mayor que cero iniciara la carga
        {
            Barra.fillAmount = tiempoAct; //va llenando lo que queda
        }
        if(tiempoAct <= 0) 
        {
            Text.text = "Actualizacion finalizada....\n presiona X para cerrar";
            InCarg(false);
            
        }

    }
    private void InCarg(bool i)
    {
        Cargar = i;
    }

    public void IncActualizacionRapida()
    {

        Preparando.SetActive(true);
        Text.text = "Preparando actualizacion rapida......";
        tiempoAct = tiempoMR;
        Barra.fillAmount = tiempoMR;
        InCarg(true);
    }
    public void ActActualizacion()
    {
        Preparando.SetActive(true);
        Text.text = "Preparando actualizacion normal......";
        tiempoAct = tiempoM;
        Barra.fillAmount = tiempoM;
        InCarg(true);
    }

    public void OpcCancelar()
    {
        MensajeAdv.SetActive(false);
    }

    public void IncCopia()
    {
        CopiaCompleta.SetActive(true);
        ActActualizacion();
    }

    //________________________Funciones de la opcion Copiar______________________________-

    public void Buscar(string Texto)
    {
        ObtenerDatos obtenerdatos = this.gameObject.AddComponent<ObtenerDatos>();
        obtenerdatos.GetCopias(HandleBuscarCopias);
        //Buscador
    }

    public void HandleBuscarCopias(List<ObtenerDatos.Copia> copias)
    {
        BuscadorDeCopia buscar_copia = this.gameObject.AddComponent<BuscadorDeCopia>();
        buscar_copia.listaDeCopias = copias;
        ObtenerDatos.Copia copia_encontrada = buscar_copia.BuscarCopiaSimilar(textoCopiaABuscar.text);
        textoResBusquedaCopia.text = copia_encontrada.CopiedDocument + " | " + copia_encontrada.OrginalDocument + " | " + copia_encontrada.CreateDate;
    }
}
